# 建议安装路径：/usr/local/nginx/conf/waf/waf_core.conf

waf on;
waf_default_action block;            # 或 log（仅记录，不阻断）
waf_trust_xff on;                    # 如部署在反向代理/负载均衡之后

# JSONL 审计日志（一次请求最多一行，含事件）
waf_json_log /var/log/nginx/waf.jsonl;
waf_json_log_level info;             # BLOCK 至少 alert 强制落盘

# 共享内存：动态封禁等
waf_shm_zone waf_dyn 32m;
waf_dynamic_block_enable on;         # 开启动态封禁
waf_dynamic_block_score_threshold 100;
waf_dynamic_block_duration 30m;
waf_dynamic_block_window_size 1m;

# 规则入口（可在发布系统中维护软链 releases/current/main.json）
waf_jsons_dir /usr/local/nginx/conf/waf/releases/current;
waf_rules_json /usr/local/nginx/conf/waf/releases/current/main.json;

# JSON extends 深度（大规则集建议限制）
waf_json_extends_max_depth 5;


